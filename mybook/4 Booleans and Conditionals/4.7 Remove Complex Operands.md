# 4.7 Remove Complex Operands

follows.

(and e1 e2) ⇒ (if e1 e2 #f)

(or e1 e2) ⇒ (if e1 #t e2)

By performing these translations in the front end of the compiler, subsequent passes of the compiler can be shorter. On the other hand, translations sometimes reduce the efficiency of the generated code by increasing the number of instructions. For example, expressing subtraction in terms of addition and negation

(- e1 e2) ⇒ (+ e1 (- e2))

produces code with two x86 instructions (negq and addq) instead of just one (subq). Thus, we do not recommend translating subtraction into addition and negation.

Exercise 4.2 Implement the pass shrink to remove and and or from the language by translating them to if expressions in LIf. Create four test programs that involve these operators. In the run-tests.rkt script, add the following entry for shrink to the list of passes (it should be the only pass at this point).

(list "shrink" shrink interp_Lif type-check-Lif)

This instructs interp-tests to run the interpreter interp_Lif and the type checker type-check-Lif on the output of shrink. Run the script to test your compiler on all the test programs.

4.6 Uniquify Variables

Add cases to uniquify_exp to handle Boolean constants and if expressions.

Exercise 4.3 Update the uniquify_exp for LIf and add the following entry to the list of passes in the run-tests.rkt script:

(list "uniquify" uniquify interp_Lif type_check_Lif)

Run the script to test your compiler.

4.7 Remove Complex Operands

The output language of remove_complex_operands is Lmon if (figure 4.11), the monadic normal form of LIf. A Boolean constant is an atomic expression, but the if expression is not. All three subexpressions of an if are allowed to be complex expressions, but the operands of the not operator and comparison operators must be atomic. Add cases to the rco_exp and rco_atom functions for the new features in LIf. In recursively processing subexpressions, recall that you should invoke rco_atom when the output needs to be an atm (as specified in the grammar for Lmon if ) and invoke rco_exp when the output should be exp. Regarding if, it is particularly important

