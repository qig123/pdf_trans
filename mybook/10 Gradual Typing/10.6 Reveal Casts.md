# 10.6 Reveal Casts 

10.6 Reveal Casts

Recall that the reveal_casts pass (section 9.5) is responsible for lowering Inject and Project into lower-level operations. In particular, Project turns into a con- ditional expression that inspects the tag and retrieves the underlying value. Here we need to augment the translation of Project to handle the situation in which the target type is PVector. Instead of using vector-length we need to use proxy-vector-length.

(project e (PVector Any1 … Anyn)) ⇒ (let tmp e′

(if (eq? (tag-of-any tmp 2)) (let tup (value-of tmp (PVector Any … Any)) (if (eq? (proxy-vector-length tup) n) tup (exit))) (exit)))

Otherwise, the only other changes are adding cases that copy the new AST nodes.

