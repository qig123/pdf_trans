# 5.5 Remove Complex Operands

![Figure 5.6...](images/page_106_vector_222.png)
*Figure 5.6*

variables set!-vars and the expression e to be processed. The case for (Var x) replaces it with (GetBang x) if it is a mutable variable or leaves it alone if not.

```
(define ((uncover-get!-exp set!-vars) e)
(match e
[(Var x)
(if (set-member? set!-vars x)
(GetBang x)
(Var x))]
...))
```

To wrap things up, define the uncover-get! function for processing a whole program, using collect-set! to obtain the set of mutable variables and then uncover-get!-exp to replace their occurrences with GetBang.

5.5 Remove Complex Operands

The new language forms, get!, set!, begin, and while are all complex expres- sions. The subexpressions of set!, begin, and while are allowed to be complex. Figure 5.6 defines the output language Lmon While of this pass. As usual, when a complex expression appears in a grammar position that needs to be atomic, such as the argument of a primitive operator, we must introduce a temporary variable and bind it to the complex expression. This approach applies, unchanged, to handle the new language forms. For example, in the following code there are two begin expressions appearing as arguments to the + operator. The output of rco_exp is then shown, in which the begin expressions have been bound to temporary variables. Recall that let expressions in Lmon While are allowed to have arbitrary expressions in their right-hand side expression, so it is fine to place begin there.

