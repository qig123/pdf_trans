# 2.11 Challenge: Partial Evaluator for LVar

2.11 Challenge: Partial Evaluator for LVar

This section describes two optional challenge exercises that involve adapting and improving the partial evaluator for LInt that was introduced in section 1.6.

Exercise 2.9 Adapt the partial evaluator from section 1.6 (figure 1.5) so that it applies to LVar programs instead of LInt programs. Recall that LVar adds variables and let binding to the LInt language, so you will need to add cases for them in the pe_exp function. Once complete, add the partial evaluation pass to the front of your compiler. Check that your compiler still passes all the tests.

Exercise 2.10 Improve on the partial evaluator by replacing the pe_neg and pe_add auxiliary functions with functions that know more about arithmetic. For example, your partial evaluator should translate

(+ 1 (+ (read) 1)) into (+ 2 (read))

To accomplish this, the pe_exp function should produce output in the form of the residual nonterminal of the following grammar. The idea is that when processing an addition expression, we can always produce one of the following: (1) an inte- ger constant, (2) an addition expression with an integer constant on the left-hand side but not the right-hand side, or (3) an addition expression in which neither subexpression is a constant.

inert ::= var | (read) | (- var) | (- (read)) | (+ inert inert) | (let ([var residual]) residual) residual ::= int | (+ int inert) | inert

The pe_add and pe_neg functions may assume that their inputs are residual expressions and they should return residual expressions. Once the improvements are complete, make sure that your compiler still passes all the tests. After all, fast code is useless if it produces incorrect results!

